# scrollback size
set -g history-limit 10000

# to set capslock to prefix edit /usr/share/X11/xkb/symbols/pc
# change CAPSLOCK ... to HOME
# basic setup
set-window-option -g mode-keys vi
# fixes slow vim
set -sg escape-time 0
set -sg status-interval 0

bind : command-prompt
set-option -g default-shell $SHELL
setw -g automatic-rename on
set-option -g detach-on-destroy off

# setup for true color
set -g default-terminal "screen-256color"
set -as terminal-overrides ",*:U8=0"
set -g prefix Home
bind-key Home send-prefix

# set-option -g mouse on
# set new tab when created to be the current directory
bind c new-window -c "#{pane_current_path}"

# split panes using | and -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# some shortcut
bind-key C-d detach-client
bind-key C-p paste-buffer
bind R refresh-client

# reload tmux config with prefix + r
unbind r
bind r \
  source-file ~/.tmux.conf \;\
  display-message 'Reloaded tmux config.'

# added mouse mode bind https://unix.stackexchange.com/a/480200
# Toggle mouse on
bind-key M \
  set-option -g mouse on \;\
  display-message 'Mouse: ON'

# Toggle mouse off
bind-key m \
  set-option -g mouse off \;\
  display-message 'Mouse: OFF'

# Ctrl - t or t new window
unbind C-t
bind-key C-t new-window

# Ctrl - w or w to kill panes
unbind C-w
bind-key C-w kill-pane

# C + control q to kill session
unbind C-q
bind-key C-q kill-session

# Switching panes with alt
bind -n M-l select-pane -L
bind -n M-h select-pane -R
bind -n M-k select-pane -U
bind -n M-j select-pane -D
bind-key -r -T prefix M-j  resize-pane -U 5
bind-key -r -T prefix M-k  resize-pane -D 5
bind-key -r -T prefix M-h  resize-pane -L 5
bind-key -r -T prefix M-l  resize-pane -R 5

# Windows customization
set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-style dim
set -g status-left ''
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %I:%M|%p '
set -g status-right-length 70
set -g status-left-length 20

setw -g window-status-current-style fg=colour81
setw -g window-status-current-style bg=colour238
setw -g window-status-current-style bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '

setw -g window-status-style fg=colour138
setw -g window-status-style bg=colour235
setw -g window-status-style none
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

setw -g window-status-bell-style bold
setw -g window-status-bell-style fg=colour255
setw -g window-status-bell-style bg=colour1

# run tmux-resurrect
run-shell ~/.config/tmux/resurrect/resurrect.tmux
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'

# restore window geometry for terminals in X11
set -g @resurrect-hook-post-save-all 'eval $(xdotool getwindowgeometry --shell $WINDOWID); echo 0,$X,$Y,$WIDTH,$HEIGHT > $XDG_CONFIG_HOME/tmux/resurrect/geometry'
set -g @resurrect-hook-pre-restore-all 'wmctrl -i -r $WINDOWID -e $(cat $XDG_CONFIG_HOME/tmux/resurrect/geometry)'

# for vim
set -g @resurrect-strategy-vim 'session'
# for neovim
set -g @resurrect-strategy-nvim 'session'
